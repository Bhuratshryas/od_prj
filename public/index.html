<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Object Detection Beeper</title>
  <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="styles.css">
  <!-- TensorFlow.js -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs"></script>
  <!-- COCO-SSD model for object detection -->
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow-models/coco-ssd"></script>
</head>
<body>
  <div class="container">
    
    <!-- Camera Status Indicator -->
    <div id="cameraStatus" class="camera-status">Camera is starting...</div>
    
    <!-- Switch Camera Button-->
    <div class="video-container">
      <video id="video" autoplay muted playsinline></video>
      <canvas id="canvas"></canvas>
    </div>
    <div class="controls">
      <button id="rotateCameraBtn">Rotate Camera</button>
    </div>
  
    <div id="movePrompt">Keep moving the object</div>
    
    <!-- Settings Button -->
    <button id="openSettingsBtn" class="settings-open-btn" aria-label="Open Settings">
      Ingredient Information Options
    </button>

    <!-- Settings Modal -->
    <div id="settingsModal" class="settings-modal" aria-modal="true" role="dialog" aria-labelledby="settingsTitle" tabindex="-1">
      <div class="settings-modal-content">
        <!-- Close Settings Button -->
        <button id="closeSettingsBtn" class="settings-close-btn" aria-label="Close Settings">&times;</button>
        <h2 id="settingsTitle">Ingredient Information Options</h2>
        <fieldset>
          <legend></legend>
          <!-- NEW settings prompts -->
          <div class="new-setting-item">
            <label for="name_prompt">Ingredient Name</label>
            <input type="checkbox" id="name_prompt" checked>
          </div>
          <div class="new-setting-item">
            <label for="expiration_range">Expiration Range</label>
            <input type="checkbox" id="expiration_range" checked>
          </div>
          <div class="new-setting-item">
            <label for="brand_name">Brand Name</label>
            <input type="checkbox" id="brand_name" checked>
          </div>
          <div class="new-setting-item">
            <label for="longer_descrip">Longer Description</label>
            <input type="checkbox" id="longer_descrip" checked>
          </div>
        </fieldset>

        <!-- Code to retreive values of prompt checkboxes, activated by Close Settings Button -->
        <script>
        document.getElementById('closeSettingsBtn').addEventListener('click', async () => {
          const settings = {
            name_prompt: document.getElementById('name_prompt').checked,
            expiration_range: document.getElementById('expiration_range').checked,
            longer_descrip: document.getElementById('longer_descrip').checked,
            brand_name: document.getElementById('brand_name').checked
          };

          await fetch('/save-settings', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(settings)
          });
        });
        </script>
      </div>
    </div>
    
    <!-- Tutorial Button -->
    <button id="openTutorialBtn" class="settings-open-btn" aria-label="Open Tutorial">
      Tutorial
    </button>
    
    <!-- Tutorial Modal -->
    <div id="tutorialModal" class="settings-modal" aria-modal="true" role="dialog" aria-labelledby="tutorialTitle" tabindex="-1">
      <div class="settings-modal-content">
        <!-- Close Tutorial Button -->
        <button id="closeTutorialBtn" class="settings-close-btn" aria-label="Close Tutorial">&times;</button>
        <h2 id="tutorialTitle">How to Use This App</h2>
        <div id="tutorialContent">
          <p>To practice, you need to place your phone face up on the table in front of you. You can then move your hand above the camera with the beeping sound until you hear the word "stop."</p>
          <p>That's it, its that simple! You can also try with an ingredient after your practice for sometime.</p>
          <p>Now press the start button to activate the camera. Press stop after you are done to deactivate the camera.</p>
        </div>
      </div>
    </div>
    
    <div class="loading-container" id="loading-container">
      <div class="loading-bar">
        <div class="loading-progress" id="loading-progress"></div>
      </div>
    </div>
    
    <img id="captured-image" class="captured-image" alt="">
    
    <div class="status">
      <div id="detectionInfo"></div>
      <div id="result"></div>
    </div>
  </div>
  
  <!-- Audio elements for feedback sounds -->
  <div class="audio-container">
    <audio id="shutterSound" src="/sounds/shutter.mp3" preload="auto"></audio>
    <audio id="processingSound" src="/sounds/processing.mp3" preload="auto" loop></audio>
    <audio id="completeSound" src="/sounds/complete.mp3" preload="auto"></audio>
  </div>

  <script src="script.js"></script>
</body>
</html>
